
- command: 'toolkit:build-dist'
  configuration: []
  expectations:
    - contains: |
        [Simulator] Simulating Filesystem\FilesystemStack()
            ->remove('.tmp/dist/prep')
            ->mkdir('.tmp/dist/prep')
        [Simulator] Simulating Remote\Rsync()
            ->fromPath('./')
            ->toPath('.tmp/dist/prep')
            ->exclude(array (
            0 => '.tmp',
            1 => 'vendor',
            ))
            ->excludeVcs()
            ->recursive()
        [Simulator] Simulating Composer\Install('composer')
            ->workingDir('.tmp/dist/prep')
            ->optimizeAutoloader()
            ->noDev()
        [Simulator] Simulating ExecStack()
            ->stopOnFail()
            ->exec('./vendor/bin/run drupal:permissions-setup --root=.tmp/dist/prep/build')
            ->exec('./vendor/bin/run drupal:settings-setup --root=.tmp/dist/prep/build')
        [Simulator] Simulating Filesystem\FilesystemStack()
            ->remove('dist')
            ->mkdir('dist')
        [Simulator] Simulating Remote\Rsync()
            ->fromPath('.tmp/dist/prep/')
            ->toPath('dist')
            ->includeFilter(array ( ... ))
            ->exclude('*')
            ->recursive()
            ->args('-aL')

- command: 'toolkit:build-dist --tag=1.0.0 --sha=29f223d5775f7f15f751cdebca140d7ed69980b7'
  configuration: []
  expectations:
    - contains: |
         [Simulator] Simulating Filesystem\FilesystemStack()
            ->remove('.tmp/dist/prep')
            ->mkdir('.tmp/dist/prep')
         [Simulator] Simulating Remote\Rsync()
            ->fromPath('./')
            ->toPath('.tmp/dist/prep')
            ->exclude(array (
              0 => '.tmp',
              1 => 'vendor',
            ))
            ->excludeVcs()
            ->recursive()
         [Simulator] Simulating Composer\Install('composer')
            ->workingDir('.tmp/dist/prep')
            ->optimizeAutoloader()
            ->noDev()
         [Simulator] Simulating ExecStack()
            ->stopOnFail()
            ->exec('./vendor/bin/run drupal:permissions-setup --root=.tmp/dist/prep/build')
            ->exec('./vendor/bin/run drupal:settings-setup --root=.tmp/dist/prep/build')
         [Simulator] Simulating Filesystem\FilesystemStack()
            ->remove('dist')
            ->mkdir('dist')
         [Simulator] Simulating Remote\Rsync()
            ->fromPath('.tmp/dist/prep/')
            ->toPath('dist')
            ->includeFilter(array ( ... ))
            ->exclude('*')
            ->recursive()
            ->args('-aL')
         [Simulator] Simulating File\Write('dist/manifest.json')
            ->text('{ ... }')
         [Simulator] Simulating File\Write('dist/build/VERSION.txt')
            ->text('1.0.0')

- command: 'toolkit:build-dist'
  configuration:
    drupal:
      root: web
    toolkit:
      build:
        dist:
          root: 'other'
  expectations:
  - contains: |
      [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove('.tmp/dist/prep')
          ->mkdir('.tmp/dist/prep')
      [Simulator] Simulating Remote\Rsync()
          ->fromPath('./')
          ->toPath('.tmp/dist/prep')
          ->exclude(array (
          0 => '.tmp',
          1 => 'vendor',
          ))
          ->excludeVcs()
          ->recursive()
      [Simulator] Simulating Composer\Install('composer')
          ->workingDir('.tmp/dist/prep')
          ->optimizeAutoloader()
          ->noDev()
      [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('./vendor/bin/run drupal:permissions-setup --root=.tmp/dist/prep/web')
          ->exec('./vendor/bin/run drupal:settings-setup --root=.tmp/dist/prep/web')
      [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove('other')
          ->mkdir('other')
      [Simulator] Simulating Remote\Rsync()
          ->fromPath('.tmp/dist/prep/')
          ->toPath('other')
          ->includeFilter(array ( ... ))
          ->exclude('*')
          ->recursive()
          ->args('-aL')

- command: 'toolkit:build-dist'
  configuration:
    drupal:
      root: web
    toolkit:
      build:
        dist:
          commands:
            - "command-one"
            - "command-two"
  expectations:
  - contains: |
      [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove('.tmp/dist/prep')
          ->mkdir('.tmp/dist/prep')
      [Simulator] Simulating Remote\Rsync()
          ->fromPath('./')
          ->toPath('.tmp/dist/prep')
          ->exclude(array (
        0 => '.tmp',
        1 => 'vendor',
      ))
          ->excludeVcs()
          ->recursive()
      [Simulator] Simulating Composer\Install('composer')
          ->workingDir('.tmp/dist/prep')
          ->optimizeAutoloader()
          ->noDev()
      [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('./vendor/bin/run drupal:permissions-setup --root=.tmp/dist/prep/web')
          ->exec('./vendor/bin/run drupal:settings-setup --root=.tmp/dist/prep/web')
      [Simulator] Simulating Filesystem\FilesystemStack()
          ->remove('dist')
          ->mkdir('dist')
      [Simulator] Simulating Remote\Rsync()
          ->fromPath('.tmp/dist/prep/')
          ->toPath('dist')
          ->includeFilter(array ( ... ))
          ->exclude('*')
          ->recursive()
          ->args('-aL')
      [Simulator] Simulating File\Write('dist/manifest.json')
          ->text('{
          "version": "latest"
      }')
      [Simulator] Simulating File\Write('dist/web/VERSION.txt')
          ->text('latest')
      [Simulator] Simulating OpenEuropa\TaskRunner\Tasks\CollectionFactory\CollectionFactory(array (
        0 => 'command-one',
        1 => 'command-two',
        ))
      [Simulator] command-one
      [Simulator] command-two

- command: 'toolkit:build-dev'
  configuration:
    drupal:
      root: web
  expectations:
  - contains: |
      [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('./vendor/bin/run drupal:settings-setup --root=web')

- command: 'toolkit:build-dev'
  configuration:
    drupal:
      root: web
    toolkit:
      build:
        dev:
          commands:
          - "command-one"
          - "command-two"
  expectations:
  - contains: |
      [Simulator] Simulating ExecStack()
          ->stopOnFail()
          ->exec('./vendor/bin/run drupal:settings-setup --root=web')
      [Simulator] Simulating OpenEuropa\TaskRunner\Tasks\CollectionFactory\CollectionFactory(array (
          0 => 'command-one',
          1 => 'command-two',
      ))

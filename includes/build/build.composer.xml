<?xml version="1.0" encoding="UTF-8" ?>
<project name="My subsite" default="help">

    <!-- Composer pre install CMD. -->
    <target name="composer-pre-install-cmd">
        <echo msg="Executing pre-install targets" />
    </target>

    <!-- Composer pre update CMD. -->
    <target name="composer-pre-update-cmd">
        <echo msg="Executing pre-update targets" />
    </target>

    <!-- Composer post update CMD. -->
    <target name="composer-post-update-cmd">
        <echo msg="Executing post-update targets" />
    </target>


    <!-- Composer post install CMD. -->
    <target
        name="composer-post-install-cmd"
        description="Commands to execute after composer install."
        depends="
            link-starterkit-binary,
            drush-dl-rr,
            setup-phpcs-pre-push"
    >
        <!-- Some subsite specific ensurance callbacks. -->
        <if>
            <isset property="project-is-subsite" />
            <then>
                <phingcall target="starterkit-ensure-subsite" />
                <phingcall target="starterkit-copy-templates" />
            </then>
        </if>
    </target>

    <!-- Ensure subsite directory structure. -->
    <target name="starterkit-ensure-subsite" hidden="true">
        <echo msg="Ensuring subsite has required directory structure." />
        <mkdir dir="${subsite.resources.dir}" />
        <mkdir dir="${subsite.resources.features.dir}" />
        <mkdir dir="${subsite.resources.modules.dir}" />
        <mkdir dir="${subsite.resources.source.dir}" />
        <mkdir dir="${subsite.resources.themes.dir}" />
    </target>

    <!-- Ensure needed files are present. -->
    <target name="starterkit-copy-templates" hidden="true">
        <echo msg="Ensuring the presence of build.xml and Jenkinsfile." />
        <copy file="${subsite.starterkit.root}/resources/templates/build.xml" tofile="${project.basedir}/build.xml" overwrite="true" />
        <copy file="${subsite.starterkit.root}/resources/templates/Jenkinsfile" tofile="${project.basedir}/Jenkinsfile" overwrite="true"/>
    </target>

    <!-- Provide handy access with root symlink to starterkit binary. -->
    <target name="link-starterkit-binary">
        <echo msg="Provide project with starterkit binary at root level." />
        <rel-sym link="${project.basedir}/ssk" target="${subsite.starterkit.bin}" overwrite="true"/>
    </target>

</project>

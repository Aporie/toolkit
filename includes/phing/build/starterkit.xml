<?xml version="1.0" encoding="UTF-8" ?>

<project default="help">

    <!-- Import helper targets if called here directly. -->
    <if>
         <available file="help.xml" />
         <then>
             <import file="help.xml" />
         </then>
     </if>

    <!-- Provide handy access with root symlink to starterkit binary. -->
    <target name="starterkit-link-binary">
        <echo msg="Provide project with starterkit binary at root level." />
        <rel-sym link="${project.basedir}/ssk" target="${ssk.bin}" overwrite="true"/>
    </target>

    <target 
        name="starterkit-init"
        depends="
            starterkit-copy-templates,
            starterkit-link-binary,
            project-platform-version-set">
        <echo msg="Starterkit successfully initiated." />
    </target>

    <!-- Ensure needed files are present. -->
    <target name="starterkit-copy-templates">
        <echo msg="Ensuring the presence of build.xml and Jenkinsfile." />
        <copy file="${ssk.root}/build.properties.dist" tofile="${project.basedir}/build.properties.dist" overwrite="true" />
        <copy todir="${project.basedir}">
            <fileset dir="${ssk.templates}/project" />
        </copy>
    </target>

    <!-- Upgrade ssk 2.x to 3.x. -->
    <target name="starterkit-upgrade">

        <!-- Delete starterkit folders. -->
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.basedir}/bin" />
        </phingcall>
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.basedir}/docs" />
        </phingcall>
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.basedir}/src" />
        </phingcall>
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.resources.dir}/cloudformation" />
        </phingcall>
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.resources.dir}/codedeploy" />
        </phingcall>
        <phingcall target="delete-folder">
            <property name="folder.to.delete" value="${project.resources.dir}/composer" />
        </phingcall>
        <!-- Delete starterkit files. -->
        <delete>
            <fileset dir="${project.basedir}">
                <include name="CHANGELOG.md" />
                <include name="LICENSE.md" />
                <include name="README.md" />
                <include name="appspec.yml" />
                <include name="build.clone.xml" />
                <include name="build.package.xml" />
                <include name="build.properties.dist" />
                <include name="build.test.xml" />
                <include name="composer.lock" />
                <include name="phpcs-ruleset.xml" />
            </fileset>
        </delete>
        <!-- Move subsite files to new location. -->
        <move file="${project.resources.dir}/phpcs-custom.xml" tofile="phpcs-ruleset.xml" overwrite="true"/>
    </target>

    <!-- Build documentation index. -->
    <target name="starterkit-build-docs">
        <build-documentation-index />        
    </target>

</project>

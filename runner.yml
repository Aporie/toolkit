# =============================================================================
# Default Task Runner configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Global Task Runner settings
# -----------------------------------------------------------------------------
runner:
  bin_dir: "./vendor/bin"
  tasks: []

# -----------------------------------------------------------------------------
# Drupal-related settings.
# -----------------------------------------------------------------------------
#
# Value of "drupal.root_absolute" is derived at runtime.
# @see OpenEuropa\TaskRunner\Commands\DrupalCommands::setRuntimeConfig()
drupal:
  root: "web"
  root_absolute: ~
  base_url: "http://google.verbruggenlex"
  version: 7

  # Basic Drupal site information.
  site:
    name: "Representation in Portugal"
    mail: "info@example.org"
    profile: "multisite_drupal_standard"
    update: "false"
    locale: "en"
    sites_subdir: "default"

  # Administrator account information.
  account:
    name: "admin"
    password: "admin"
    mail: "admin@example.org"

  # Database settings.
  database:
    host: "mysql"
    port: "3306"
    name: "drupal"
    user: "user"
    password: "password"

  # Local Drush settings file will be generated by following default values.
  drush:
    options:
      uri: "${drupal.base_url}"

  # Following lines will be converted in PHP and appended to default.settings.php.
  settings: []

  # List of shell commands to be before and after the site installation.
  # You can use same syntax as the "commands:", check the documentation for more.
  # Configuration token replacement is supported too.
  pre_install: []
  post_install:
    - "${runner.bin_dir}/run drupal:setup-development"

# -----------------------------------------------------------------------------
# GitHub configuration values.
# -----------------------------------------------------------------------------
github:
  # GitHub personal access token token.
  # @link https://github.com/settings/tokens
  token: ~

# -----------------------------------------------------------------------------
# Release commands configuration values.
# -----------------------------------------------------------------------------
release:

  # List of tasks to be ran before creating the release archive.
  tasks: []

  # Time and date formats used when generating values below.
  time_format: "H:i:s"
  date_format: "Y-m-d"

  # The following values are created at runtime and can be used when appending
  # release notes to text files.
  # They can be accessed via ${release.NAME}
# version: ~
# date: ~
# time: ~
# timestamp: ~

# -----------------------------------------------------------------------------
# List of dynamically-defined commands.
# -----------------------------------------------------------------------------
commands:
  project:install:
    - composer install --ansi --no-suggest && git init
    - cp web/sites/default/default.settings.php web/sites/default/settings.php
    - cp resources/settings.local.php web/sites/default/settings.local.php
    - mkdir -p web/sites/default/files/private_files
    - while ! mysqladmin ping --user=root -h mysql --password="" --silent; do echo Waiting for mysql; sleep 3; done
    - /usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" ./vendor/bin/drush -r web si --db-url=mysql://root:@mysql:3306/drupal ${drupal.site.profile} -y --color=1
  project:phpcs:
    - ./vendor/bin/grumphp run --ansi
  project:behat:
    - mkdir -p web/sites/all/modules/contrib
    - ln -sf ${PWD}/vendor/drupal/drupal-extension/fixtures/drupal${drupal.version}/modules/behat_test ${PWD}/web/sites/all/modules/contrib/behat_test
    - ./vendor/bin/drush -r web en behat_test -y --color=1
    - cp behat.yml ./vendor/drupal/drupal-extension/behat.yml
    - ./vendor/bin/behat -c vendor/drupal/drupal-extension/behat.yml --colors -v
  project:smoketest:
    - ${runner.bin_dir}/drush -r ${drupal.root} en $(${runner.bin_dir}/drush -r ${drupal.root} sqlq \"select GROUP_CONCAT(name) from system where status=0 and name not like '%_test%'\") -y
    - ${runner.bin_dir}/drush -r ${drupal.root} dis overlay toolbar -y
    - ${runner.bin_dir}/drush -r ${drupal.root} cron
    - ${runner.bin_dir}/drush -r ${drupal.root} generate-users 50 --kill --pass=password
    - ${runner.bin_dir}/drush -r ${drupal.root} generate-vocabs 1 --kill
    - ${runner.bin_dir}/drush -r ${drupal.root} generate-terms $(${runner.bin_dir}/drush -r ${drupal.root} sqlq \"select name from taxonomy_vocabulary limit 1;\") 50 --kill
    - ${runner.bin_dir}/drush -r ${drupal.root} generate-content 50 3 --kill --types=$(${runner.bin_dir}/drush -r ${drupal.root} sqlq \"select GROUP_CONCAT(type) from node_type where name <> 'poll'\") --kill
    - ${runner.bin_dir}/drush -r ${drupal.root} generate-menus 2 50 --kill
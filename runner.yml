# =============================================================================
# Default Task Runner configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Global Task Runner settings
# -----------------------------------------------------------------------------
runner:
  bin_dir: "./vendor/bin"
  tasks: []

# -----------------------------------------------------------------------------
# GitHub configuration values.
# -----------------------------------------------------------------------------
github:
  # GitHub personal access token token.
  # @link https://github.com/settings/tokens
  token: ~

# -----------------------------------------------------------------------------
# Release commands configuration values.
# -----------------------------------------------------------------------------
release:

  # List of tasks to be ran before creating the release archive.
  tasks: []

  # Time and date formats used when generating values below.
  time_format: "H:i:s"
  date_format: "Y-m-d"

  # The following values are created at runtime and can be used when appending
  # release notes to text files.
  # They can be accessed via ${release.NAME}
# version: ~
# date: ~
# time: ~
# timestamp: ~

# -----------------------------------------------------------------------------
# Drupal template.
# -----------------------------------------------------------------------------
drupal:
  drupal7_template: resources/templates/drupal7
  drupal8_template: resources/templates/drupal8
  
  

# -----------------------------------------------------------------------------
# List of dynamically-defined commands.
# -----------------------------------------------------------------------------
commands:
  project:test-drupal7:
    - rm -rf build
    - cd ${drupal.drupal7_template} && composer install --ansi --no-suggest && git init
    - ln -sf ${PWD}/${drupal.drupal7_template}/web ${PWD}/build
    - ln -sf ${PWD}/${drupal.drupal7_template}/vendor/drupal/drupal-extension/fixtures/drupal7/modules/behat_test ${PWD}/${drupal.drupal7_template}/web/sites/all/modules/contrib/behat_test
    - cd ${drupal.drupal7_template} && ./vendor/bin/grumphp run --ansi
    - while ! mysqladmin ping --user=root -h mysql --password="" --silent; do echo Waiting for mysql; sleep 3; done
    - cd ${drupal.drupal7_template} && /usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" ./vendor/bin/drush -r web si --db-url=mysql://root:@mysql:3306/drupal standard -y
    - cd ${drupal.drupal7_template} && ./vendor/bin/drush -r web en behat_test -y
    - cd ${drupal.drupal7_template} && cp behat.yml ./vendor/drupal/drupal-extension/behat.yml
    - cd ${drupal.drupal7_template} && ./vendor/bin/behat -c vendor/drupal/drupal-extension/behat.yml --colors
  project:test-drupal8:
    - rm -rf build
    - composer install --working-dir=${drupal.drupal8_template} --ansi --no-suggest
    - git --git-dir=${drupal.drupal8_template}/.git init
    - ln -sf ${PWD}/${drupal.drupal8_template}/web ${PWD}/build
    - mkdir -p ${PWD}/${drupal.drupal8_template}/web/modules/contrib
    - ln -sf ${PWD}/${drupal.drupal8_template}/vendor/drupal/drupal-extension/fixtures/drupal8/modules/behat_test ${PWD}/${drupal.drupal8_template}/web/modules/contrib/behat_test
    - cd ${drupal.drupal8_template} && ./vendor/bin/grumphp run --ansi
    - while ! mysqladmin ping --user=root -h mysql --password="" --silent; do echo Waiting for mysql; sleep 3; done
    - cd ${drupal.drupal8_template} && /usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" ./vendor/bin/drush -r web si --db-url=mysql://root:@mysql:3306/drupal standard -y
    - cd ${drupal.drupal8_template} && ./vendor/bin/drush -r web en behat_test -y
    - cd ${drupal.drupal8_template} && cp behat.yml ./vendor/drupal/drupal-extension/behat.yml
    - cd ${drupal.drupal8_template} && ./vendor/bin/behat -c vendor/drupal/drupal-extension/behat.yml --colors